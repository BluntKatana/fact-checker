import spacy

def check_query_in_context(query, context):
    # Load the spaCy model
    nlp = spacy.load("en_core_web_sm")

    # Process the query and context
    doc_query = nlp(query)
    doc_context = nlp(context)

    # Extract named entities and relationships from the query
    query_entities = {ent.text.lower() for ent in doc_query.ents}
    print("query_entities",query_entities)
    query_relationships = {token.text.lower() for token in doc_query if token.dep_ == "attr"}
    print("queryrelations",query_relationships)

    # Check if the query entities and relationships are mentioned in the context
    is_query_in_context = (
        all(entity.text.lower() in context.lower() for entity in doc_query.ents)
        and all(relationship.lower() in context.lower() for relationship in query_relationships)
    )

    return is_query_in_context

# Example
query = "Rome is the capital of Italy"
context = "Italy (Italian: Italia [iˈtaːlja] ⓘ), officially the Italian Republic, is a country in Southern[13][14][15] and Western[16][a] Europe. Located in the middle of the Mediterranean Sea, it consists of a peninsula delimited by the Alps and surrounded by several islands.[17] Italy shares land borders with France, Switzerland, Austria, Slovenia and the enclaved microstates of Vatican City and San Marino. It has a territorial exclave in Switzerland (Campione) and an archipelago in the African Plate (Pelagie Islands). Italy covers an area of 301,340 km2 (116,350 sq mi),[3] with a population of nearly 60 million;[18] it is the tenth-largest country by land area in the European continent and the third-most populous member state of the European Union. Its capital and largest city is Rome."

# Check if the query is mentioned in the context
result = check_query_in_context(query, context)

# Print the result
if result:
    print("The context agrees with the query.")
else:
    print("The context does not fully agree with the query.")
